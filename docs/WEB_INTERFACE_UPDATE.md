# Web 界面更新说明

## 概述

Web 界面已同步更新，完整支持新的排序算法功能（关键词优先级和平台权重）。

## 更新内容

### ✅ 1. 权重配置界面升级

#### 新增配置项

- ✨ **关键词权重** (`keyword_weight`) - 关键词匹配度的影响权重
- ✨ **时效性权重** (`freshness_weight`) - 新出现内容的影响权重  
- ✨ **平台权重系数** (`platform_weight`) - 平台权重的影响系数

#### 界面改进

- 🎨 优化了权重配置布局，采用 2x3 网格布局
- 📊 更新权重和计算公式，包含所有 5 个权重项
- 💡 添加每个权重的说明文本
- ✅ 实时显示权重总和验证

**位置**：功能设置 → 系统配置 → 智能排序算法

### ✅ 2. 平台管理界面升级

#### 新增功能

- ⭐ 每个平台新增**权重输入框**
- 📝 添加权重说明和使用提示
- 🎯 默认权重为 1.0

#### 配置说明

```
默认1.0，优质平台可设置>1.0，娱乐平台可设置<1.0
```

**位置**：功能设置 → 平台管理

### ✅ 3. 关键词配置界面升级

#### 新增功能

- ⭐ 每个关键词组新增**优先级选择器**
- 🎚️ 优先级范围：1-10（1最低，10最高）
- 🔤 下拉选择框，清晰标注等级

#### 优先级选项

```
10 - 最高
9 - 很高  
8 - 高
7 - 较高
6 - 中上
5 - 中等（默认）
4 - 中下
3 - 较低
2 - 低
1 - 最低
```

**位置**：功能设置 → 关键词配置

### ✅ 4. 数据展示界面升级

#### 新增展示内容

在 Trending 页面的每条新闻下方，新增显示：

- ⭐ **匹配分数** - 绿色徽章显示关键词匹配得分
- 🏷️ **匹配的关键词** - 彩色标签显示匹配到的关键词
  - 必须词（+开头）：黄色背景
  - 普通词：蓝色背景

#### 示例效果

```
[平台：知乎] [原榜单 #3] [⭐ 匹配分: 85.0] [+AI] [人工智能]
```

**位置**：Trending → 历史记录详情

### ✅ 5. 帮助文档升级

#### 更新关键词规则说明弹窗

新增以下内容：

1. **优先级说明**
   - 什么是优先级
   - 如何设置优先级
   - 优先级使用示例

2. **智能排序说明**
   - 多维度排序算法介绍
   - 排序因素说明

3. **注意事项更新**
   - 添加优先级使用建议
   - 添加平台权重配合使用提示

**位置**：功能设置 → 关键词配置 → 规则说明

## 技术实现细节

### JavaScript 更新

#### 1. 权重和计算更新

```javascript
const weightSum = computed(() => {
    if (!configObj.value || !configObj.value.weight) return 0
    const w = configObj.value.weight
    return (w.rank_weight || 0) + 
           (w.frequency_weight || 0) + 
           (w.hotness_weight || 0) + 
           (w.keyword_weight || 0) + 
           (w.freshness_weight || 0)
})
```

#### 2. 关键词组初始化更新

```javascript
const addKeywordGroup = () => {
    keywordGroups.value.push({ 
        normal: [], 
        required: [], 
        filters: [], 
        priority: 5  // 新增默认优先级
    })
}
```

#### 3. 平台初始化更新

```javascript
const addPlatform = () => {
    if (!configObj.value.platforms) {
        configObj.value.platforms = []
    }
    configObj.value.platforms.push({ 
        id: '', 
        name: '', 
        weight: 1.0  // 新增默认权重
    })
}
```

### HTML/CSS 更新

#### 1. 响应式布局

- 权重配置采用 `col-span-6` 实现 2列布局
- 平台卡片使用 `grid-template-columns: repeat(auto-fill, minmax(280px, 1fr))`
- 新闻展示信息使用 `flex-wrap: wrap` 适配不同屏幕

#### 2. 视觉标识

所有新增功能都标注了 `⭐` 图标和"新增"文字，方便用户识别。

#### 3. 颜色方案

- 匹配分数：绿色（`#d1fae5` / `#065f46`）
- 必须词标签：黄色（`#fef3c7` / `#78350f`）  
- 普通词标签：蓝色（`#dbeafe` / `#1e40af`）
- 新增标识：绿色（`#059669`）

## 兼容性保证

### 向后兼容

所有新字段都有默认值，旧数据可以正常显示：

- `priority` 未设置时默认为 5
- `weight` 未设置时默认为 1.0
- `keyword_weight` 等新权重未设置时使用默认计算

### 数据迁移

无需手动迁移，系统会自动：
- 为新添加的关键词组设置默认优先级 5
- 为新添加的平台设置默认权重 1.0
- 为新配置项填充默认值

## 使用流程

### 1. 设置关键词优先级

1. 进入"功能设置" → "关键词配置"
2. 为每个关键词组选择优先级（1-10）
3. 重要的设置为 10，一般的设置为 5，次要的设置为 2-3
4. 点击"保存关键词"

### 2. 设置平台权重

1. 进入"功能设置" → "平台管理"  
2. 为每个平台设置权重（0-2）
3. 优质平台设置 1.0-1.2，娱乐平台设置 0.6-0.8
4. 点击"保存配置"

### 3. 调整权重配置

1. 进入"功能设置" → "系统配置"
2. 滚动到"智能排序算法"部分
3. 调整各项权重（建议总和为 1.0）
4. 重点调整 `keyword_weight`（推荐 0.3-0.5）
5. 点击"保存配置"

### 4. 查看效果

1. 进入"Trending"页面
2. 选择一个日期查看历史记录
3. 观察每条新闻的匹配分数和匹配关键词
4. 确认高优先级关键词的内容是否排在前面

## 界面截图说明

### 权重配置界面

```
┌────────────────────────────────────────────────────┐
│ 智能排序算法                                          │
├────────────────────────────────────────────────────┤
│ ℹ️  所有权重值之和建议为 1.0，当前总和：1.00 ✓        │
├─────────────────────┬──────────────────────────────┤
│ 排名权重      0.3   │ 频次权重      0.2             │
│ 原始平台排名的影响权重 │ 重复出现次数的影响权重         │
├─────────────────────┼──────────────────────────────┤
│ 关键词权重 ⭐  0.4  │ 时效性权重 ⭐  0.1            │
│ 关键词匹配度的影响权重 │ 新出现内容的影响权重          │
├─────────────────────┼──────────────────────────────┤
│ 热度权重      0.0   │ 平台权重系数 ⭐ 1.0           │
│ 热度数值的影响权重   │ 平台权重的影响系数            │
└─────────────────────┴──────────────────────────────┘
```

### 平台管理界面

```
┌──────────────────────────────────┐
│ 知乎                              │
│ ID: zhihu                        │
│                                  │
│ 平台权重 ⭐                       │
│ [  1.2  ] ▼                      │
│ 默认1.0，优质平台可设置>1.0       │
└──────────────────────────────────┘
```

### 关键词配置界面

```
┌────────────────────────────────────────────────┐
│ 词组 1   优先级 ⭐ [ 10 - 最高  ▼]              │
├────────────────────────────────────────────────┤
│ ● 普通词（任意匹配）                            │
│ [AI] [人工智能] + 添加普通词                   │
│                                                │
│ ● 必须词（必须包含）                            │
│ [+突破] + 添加必须词                           │
│                                                │
│ ● 过滤词（排除）                                │
│ [!广告] + 添加过滤词                           │
└────────────────────────────────────────────────┘
```

### 数据展示效果

```
1  OpenAI 发布重大突破：新AI模型性能提升
   
   [知乎] [原榜单 #3] [⭐ 匹配分: 85.0] [+AI] [人工智能] [+突破]
```

## 故障排查

### 问题1：权重配置保存后未生效

**可能原因**：
- 浏览器缓存导致
- 配置未正确同步

**解决方法**：
1. 刷新页面（Ctrl+F5 强制刷新）
2. 检查配置是否正确保存
3. 重启 TrendHub 服务

### 问题2：匹配分数和关键词不显示

**可能原因**：
- 旧数据没有匹配分数信息
- API 返回的数据格式不完整

**解决方法**：
1. 运行一次新的数据采集
2. 查看浏览器控制台是否有错误
3. 确认后端已更新到最新版本

### 问题3：优先级设置后排序没变化

**可能原因**：
- `keyword_weight` 权重设置过低
- 关键词组没有正确保存优先级

**解决方法**：
1. 提高 `keyword_weight` 到 0.4-0.5
2. 检查关键词配置页面，确认优先级已保存
3. 查看匹配分数，确认高优先级内容分数更高

## 测试建议

### 功能测试清单

- [ ] 权重配置界面显示正常
- [ ] 权重和计算正确
- [ ] 平台管理可以设置权重
- [ ] 关键词配置可以设置优先级
- [ ] 数据展示显示匹配信息
- [ ] 规则说明内容完整
- [ ] 配置保存功能正常
- [ ] 数据刷新显示正确
- [ ] 深色模式显示正常
- [ ] 响应式布局正常

### 端到端测试

1. **设置测试数据**
   - 添加一个优先级 10 的关键词组
   - 添加一个优先级 2 的关键词组
   - 设置知乎权重为 1.2
   - 设置抖音权重为 0.7

2. **运行数据采集**
   - 执行一次完整的数据采集
   - 观察采集到的数据

3. **验证排序效果**
   - 查看 Trending 页面
   - 确认高优先级关键词的内容排在前面
   - 确认知乎平台的内容比抖音排名靠前
   - 查看匹配分数，确认分数合理

4. **验证显示效果**
   - 确认匹配分数显示
   - 确认匹配关键词标签显示
   - 确认颜色和样式正确

## 性能优化

### 前端性能

- 使用 Vue 3 的响应式系统，高效更新
- 数据展示采用虚拟滚动（如有大量数据）
- 图标和样式使用内联SVG，减少请求

### 加载优化

- 静态资源使用 CDN
- 配置使用懒加载
- 历史数据按需加载

## 后续计划

1. **数据可视化**
   - 添加匹配分数分布图
   - 添加关键词匹配统计

2. **用户体验**
   - 添加配置导入/导出功能
   - 添加配置模板

3. **功能增强**
   - 支持批量设置优先级
   - 支持优先级预设方案

## 相关文档

- [排序算法优化说明](./RANKING_OPTIMIZATION.md)
- [排序优化迁移指南](./RANKING_MIGRATION.md)
- [配置热重载功能](./CONFIG_HOT_RELOAD.md)

---

更新时间：2024-11-21  
版本：v1.1.0（Web 界面优化版）

